<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Analytics Dashboard</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>">
    
    <!-- React and ReactDOM - IMPORTANT: Use development version for better error messages -->
    <script crossorigin src="https://unpkg.com/react@16.14.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16.14.0/umd/react-dom.development.js"></script>
    
    <!-- PropTypes - Required by Recharts -->
    <script crossorigin src="https://unpkg.com/prop-types@15.7.2/prop-types.min.js"></script>
    
    <!-- Load Recharts directly -->
    <script src="https://unpkg.com/recharts@2.0.9/umd/Recharts.min.js"></script>
    
    <!-- Papa Parse for CSV handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone@7.21.4/babel.min.js"></script>
    
    <!-- Tailwind CSS - For development only -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- No more Recharts extraction script - moved to dashboard-loader.js -->
    </script>
</head>
<body class="bg-gray-100">
    <div id="root">
        <!-- Loading state while React loads -->
        <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
            <div class="bg-white rounded-lg shadow-md p-8 max-w-md w-full text-center">
                <h1 class="text-2xl font-bold mb-4">Marketing Analytics Dashboard</h1>
                <p class="mb-6 text-gray-600">Loading the dashboard components...</p>
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"></div>
                <p class="mt-6 text-sm text-gray-500">
                    The dashboard will appear momentarily. If it doesn't load, please check your browser console for any errors.
                </p>
            </div>
        </div>
    </div>

    <!-- Inline marketing dashboard component -->
    <script type="text/babel">
        // Simple version of the Marketing Dashboard with minimal functionality
        const MarketingDashboard = () => {
          // Use React.useState to ensure compatibility
          const [activeDashboard, setActiveDashboard] = React.useState('overview');
          
          // Overview dashboard - shows a summary of all platforms
          const OverviewDashboard = () => {
            return (
              <div className="container mx-auto px-4 py-8">
                <div className="bg-white rounded-lg shadow-md p-6 mb-8">
                  <h2 className="text-2xl font-bold mb-4">Quick Analytics Overview</h2>
                  <p className="text-gray-600 mb-4">
                    Welcome to the Marketing Analytics Dashboard. This tool provides a comprehensive view of your marketing performance across multiple channels.
                  </p>
                  
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div className="bg-blue-50 p-6 rounded-lg border border-blue-100">
                      <h3 className="text-lg font-semibold text-blue-800 mb-3">Web Analytics</h3>
                      <p className="text-sm text-gray-600">
                        Analyze website traffic sources, user demographics, and page performance.
                      </p>
                      <button 
                        className="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm"
                        onClick={() => setActiveDashboard('web')}
                      >
                        View Dashboard
                      </button>
                    </div>
                    
                    <div className="bg-pink-50 p-6 rounded-lg border border-pink-100">
                      <h3 className="text-lg font-semibold text-pink-800 mb-3">Social Media</h3>
                      <p className="text-sm text-gray-600">
                        Track engagement, followers growth, and top-performing posts across platforms.
                      </p>
                      <button 
                        className="mt-4 bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded text-sm"
                        onClick={() => setActiveDashboard('social')}
                      >
                        View Dashboard
                      </button>
                    </div>
                    
                    <div className="bg-purple-50 p-6 rounded-lg border border-purple-100">
                      <h3 className="text-lg font-semibold text-purple-800 mb-3">Email Campaigns</h3>
                      <p className="text-sm text-gray-600">
                        Monitor open rates, click-through rates, and subscriber engagement.
                      </p>
                      <button 
                        className="mt-4 bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded text-sm"
                        onClick={() => setActiveDashboard('email')}
                      >
                        View Dashboard
                      </button>
                    </div>
                    
                    <div className="bg-red-50 p-6 rounded-lg border border-red-100">
                      <h3 className="text-lg font-semibold text-red-800 mb-3">YouTube Performance</h3>
                      <p className="text-sm text-gray-600">
                        Analyze video engagement, viewer demographics, and subscription metrics.
                      </p>
                      <button 
                        className="mt-4 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm"
                        onClick={() => setActiveDashboard('youtube')}
                      >
                        View Dashboard
                      </button>
                    </div>
                  </div>
                </div>
                
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h2 className="text-2xl font-bold mb-4">Getting Started</h2>
                  <div className="text-gray-600">
                    <p className="mb-4">
                      To use this dashboard, follow these steps:
                    </p>
                    <ol className="list-decimal pl-5 space-y-2 mb-4">
                      <li>Download analytics data from each platform (Google Analytics, Facebook, Instagram, Email Provider, YouTube)</li>
                      <li>Upload the CSV files to each respective dashboard using the "Upload Data" button</li>
                      <li>Use the date range selector to analyze specific time periods</li>
                      <li>Enable comparison feature to compare current performance with previous periods</li>
                    </ol>
                    <p className="mt-4 p-4 bg-yellow-50 border border-yellow-100 rounded">
                      <strong>Note:</strong> This dashboard runs entirely in your browser. Your data is never sent to any server.
                    </p>
                  </div>
                </div>
              </div>
            );
          };
          
          // Placeholder for other dashboards
          const PlaceholderDashboard = ({ title }) => (
            <div className="container mx-auto px-4 py-8 text-center">
              <div className="bg-white rounded-lg shadow-md p-8">
                <h2 className="text-2xl font-bold mb-4">{title}</h2>
                <p className="text-gray-600 mb-6">
                  This dashboard is coming soon. Please check back later or use the main navigation to return to overview.
                </p>
                <button 
                  className="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700"
                  onClick={() => setActiveDashboard('overview')}
                >
                  Return to Overview
                </button>
              </div>
            </div>
          );
          
          // Simplified header component
          const Header = () => (
            <header className="bg-white shadow">
              <div className="container mx-auto px-4 py-6">
                <h1 className="text-3xl font-bold text-gray-900">Marketing Analytics Dashboard</h1>
              </div>
            </header>
          );
          
          // Simplified navigation component
          const Navigation = () => (
            <nav className="bg-gray-800 text-white shadow">
              <div className="container mx-auto px-4">
                <div className="flex overflow-x-auto">
                  <button 
                    className={`px-4 py-4 whitespace-nowrap hover:bg-gray-700 ${activeDashboard === 'overview' ? 'bg-gray-700 font-medium' : ''}`}
                    onClick={() => setActiveDashboard('overview')}
                  >
                    Overview
                  </button>
                  <button 
                    className={`px-4 py-4 whitespace-nowrap hover:bg-gray-700 ${activeDashboard === 'web' ? 'bg-gray-700 font-medium' : ''}`}
                    onClick={() => setActiveDashboard('web')}
                  >
                    Web Analytics
                  </button>
                  <button 
                    className={`px-4 py-4 whitespace-nowrap hover:bg-gray-700 ${activeDashboard === 'social' ? 'bg-gray-700 font-medium' : ''}`}
                    onClick={() => setActiveDashboard('social')}
                  >
                    Social Media
                  </button>
                  <button 
                    className={`px-4 py-4 whitespace-nowrap hover:bg-gray-700 ${activeDashboard === 'email' ? 'bg-gray-700 font-medium' : ''}`}
                    onClick={() => setActiveDashboard('email')}
                  >
                    Email Campaigns
                  </button>
                  <button 
                    className={`px-4 py-4 whitespace-nowrap hover:bg-gray-700 ${activeDashboard === 'youtube' ? 'bg-gray-700 font-medium' : ''}`}
                    onClick={() => setActiveDashboard('youtube')}
                  >
                    YouTube
                  </button>
                </div>
              </div>
            </nav>
          );
          
          // Render the appropriate dashboard based on active selection
          const renderDashboard = () => {
            switch (activeDashboard) {
              case 'web':
                return <PlaceholderDashboard title="Web Analytics Dashboard" />;
              case 'social':
                return <PlaceholderDashboard title="Social Media Dashboard" />;
              case 'email':
                return <PlaceholderDashboard title="Email Campaigns Dashboard" />;
              case 'youtube':
                return <PlaceholderDashboard title="YouTube Analytics Dashboard" />;
              case 'overview':
              default:
                return <OverviewDashboard />;
            }
          };
          
          return (
            <div className="min-h-screen bg-gray-100 flex flex-col">
              <Header />
              <Navigation />
              <main className="flex-grow">
                {renderDashboard()}
              </main>
              <footer className="bg-white shadow-inner mt-8 py-4">
                <div className="container mx-auto px-4">
                  <p className="text-gray-600 text-center">
                    &copy; {new Date().getFullYear()} Marketing Analytics Dashboard
                  </p>
                </div>
              </footer>
            </div>
          );
        };
        
        // This bridge attaches the marketing dashboard component to the window object
        (function() {
          console.log("Marketing Dashboard Bridge: Running");
          
          // Create a reference to the component on the window object
          if (typeof MarketingDashboard === 'function') {
            console.log("Marketing Dashboard Bridge: Component found");
            window.MarketingDashboard = { 
              default: MarketingDashboard 
            };
            console.log("Marketing Dashboard Bridge: Component attached to window");
          } else {
            console.error("Marketing Dashboard Bridge: Component not found");
          }
        })();
    </script>
    
    <!-- Initialize the app -->
    <script type="text/babel">
        // Simple stub to keep babel happy - actual initialization is below
        console.log("Babel preprocessor running on initialization stub");
    </script>
    
    <!-- Loader script (inline instead of external file) -->
    <script>
        // This script handles loading all necessary components in the correct order
        (function() {
          // Configure debug mode
          const DEBUG = true;
          
          // Helper function for logging
          function log(message) {
            if (DEBUG) {
              console.log(`[Loader] ${message}`);
            }
          }
          
          // Helper function for logging errors
          function logError(message, error) {
            console.error(`[Loader Error] ${message}`, error);
          }
          
          // Check if a library is loaded
          function isLibraryLoaded(libraryName, globalVar) {
            const loaded = typeof window[globalVar] !== 'undefined';
            log(`${libraryName} loaded: ${loaded}`);
            return loaded;
          }
          
          // Load Recharts components
          function loadRechartsComponents() {
            log("Setting up Recharts components");
            try {
              if (typeof Recharts !== 'undefined') {
                window.LineChart = Recharts.LineChart;
                window.BarChart = Recharts.BarChart;
                window.PieChart = Recharts.PieChart;
                window.Line = Recharts.Line;
                window.Bar = Recharts.Bar;
                window.Pie = Recharts.Pie;
                window.Cell = Recharts.Cell;
                window.XAxis = Recharts.XAxis;
                window.YAxis = Recharts.YAxis;
                window.CartesianGrid = Recharts.CartesianGrid;
                window.Tooltip = Recharts.Tooltip;
                window.Legend = Recharts.Legend;
                window.ResponsiveContainer = Recharts.ResponsiveContainer;
                log("Recharts components extracted successfully");
                return true;
              } else {
                logError("Recharts library not loaded properly!");
                return false;
              }
            } catch (e) {
              logError("Error setting up Recharts components:", e);
              return false;
            }
          }
          
          // Render the marketing dashboard
          function renderDashboard() {
            log("Attempting to render Marketing Dashboard");
            try {
              const MarketingDashboard = window.MarketingDashboard?.default;
              
              if (MarketingDashboard) {
                log("MarketingDashboard component found, rendering...");
                ReactDOM.render(
                  React.createElement(MarketingDashboard, null),
                  document.getElementById('root')
                );
                log("Dashboard rendered successfully");
                return true;
              } else {
                throw new Error("Marketing Dashboard component not found");
              }
            } catch (error) {
              logError("Error rendering dashboard:", error);
              document.getElementById('root').innerHTML = `
                <div class="p-8 text-center">
                  <h1 class="text-2xl font-bold text-red-600 mb-4">Dashboard Error</h1>
                  <p class="mb-4">${error.message}</p>
                  <details class="text-left bg-gray-100 p-4 rounded">
                    <summary class="cursor-pointer mb-2">Technical Details</summary>
                    <pre class="whitespace-pre-wrap text-xs">${error.stack}</pre>
                  </details>
                </div>
              `;
              return false;
            }
          }
          
          // Check prerequisites
          function checkPrerequisites() {
            let allLoaded = true;
            
            // Check React
            allLoaded = allLoaded && isLibraryLoaded("React", "React");
            
            // Check ReactDOM
            allLoaded = allLoaded && isLibraryLoaded("ReactDOM", "ReactDOM");
            
            // Check Recharts
            allLoaded = allLoaded && isLibraryLoaded("Recharts", "Recharts");
            
            // Check Papa Parse
            allLoaded = allLoaded && isLibraryLoaded("Papa Parse", "Papa");
            
            return allLoaded;
          }
          
          // Main initialization function
          function init() {
            log("Starting dashboard initialization");
            
            // Step 1: Check prerequisites
            const prerequisitesLoaded = checkPrerequisites();
            if (!prerequisitesLoaded) {
              logError("Not all prerequisites are loaded. Check console for details.");
              return;
            }
            
            // Step 2: Load Recharts components
            const rechartsLoaded = loadRechartsComponents();
            if (!rechartsLoaded) {
              logError("Failed to load Recharts components.");
              return;
            }
            
            // Step 3: Wait for all dashboard components to be loaded by Babel
            log("Waiting for dashboard components to be loaded by Babel...");
            setTimeout(() => {
              // Step 4: Check if dashboard components are available
              log("Checking dashboard components availability...");
              const isDashboardAvailable = typeof window.MarketingDashboard !== 'undefined';
              log(`MarketingDashboard available: ${isDashboardAvailable}`);
              
              if (isDashboardAvailable) {
                // Step 5: Render the dashboard
                renderDashboard();
              } else {
                logError("Dashboard components not found after waiting.");
                document.getElementById('root').innerHTML = `
                  <div class="p-8 text-center">
                    <h1 class="text-2xl font-bold text-red-600 mb-4">Loading Error</h1>
                    <p class="mb-4">The dashboard components could not be loaded.</p>
                    <div class="bg-yellow-50 p-4 rounded border border-yellow-100 mt-4 text-left">
                      <h4 class="font-medium text-yellow-800 mb-2">Possible reasons:</h4>
                      <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
                        <li>JS files could not be loaded (check network tab)</li>
                        <li>Babel could not transpile the JSX (check console for errors)</li>
                        <li>Component bridging failed (check if bridge files are loaded)</li>
                      </ul>
                    </div>
                  </div>
                `;
              }
            }, 2000); // Longer timeout for Babel processing
          }
          
          // Set up initialization when the window is fully loaded
          if (document.readyState === 'complete') {
            init();
          } else {
            window.addEventListener('load', init);
          }
        })();
    </script>
</body>
</html>